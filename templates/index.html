<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Gather</title>
    <link href="/static/css/styles.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="max-w-screen-lg">
    <div x-data="flash" x-init="loadMessage" x-show="message" class="absolute top-10 left-5 rounded shadow border border-slate-400 bg-green-200">
        <p class="py-5 px-10" x-text="message"></p>
    </div>
    <div class="p-2" x-data="supplierSelection" x-init="checkPassedSupplier" @fetchsupplier.window="fetchSupplierData()">
        <h1>Supplier Gathering</h1>
        <fieldset class="flex justify-center align-middle gap-2 m-4 p-2 border border-slate-200 rounded">
            <label for="supplier">Supplier
                <select name="supplier" id="supplierselect" x-model="selection" @change="load_disabled = !selection;">
                    <option value="" selected>Select a supplier</option>
                    {% for supplier in suppliers %}
                        {% if supplier.value %}
                            <option value="{{supplier.value}}">{{supplier.label}}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </label>
            <button type="submit" class="px-4 py-2 rounded font-bold text-white"
            :class="load_disabled ? 'bg-slate-300' : 'bg-blue-700'"
            :disabled="load_disabled" @click.prevent="fetchSupplierData()">
                Load supplier
            </button>
        </fieldset>
    </div>
    <div class="flex">
        <form class="border border-slate-200 rounded m-2 p-2" x-data="newAutomation"> <!-- New Automation -->
            <h2 class="text-center font-bold text-lg">New Automation</h2>
            <fieldset>
                <label for="name">Name
                    <input type="text" x-model="name" name="name" placeholder="Enter a name" required />
                </label>
                <label for="download_type">Type
                    <select name="download_type" x-model="type" required>
                        <option selected="true">Select a fetch type</option>
                        <option value="1">Download</option>
                        <option value="0">Automation</option>
                    </select>
                </label>
                <label for="download_url" x-show="type == 1">Download URL
                    <input type="url" x-model="url" name="download_url" placeholder="Enter the download URL" :required="type == 1" />
                </label>
                <label for="location">Save location
                    <select name="location" x-model="location" required>
                        <option selected="true">Select where to save the file(s)</option>
                        <option value="83475173jwegbfby228ur8">Root WorkDrive Folder</option>
                        <option value="iuhs87sb6sd7b9db797b98">WorkDrive Folder 2</option>
                    </select>
                </label>
            </fieldset>
            <fieldset>
                <button type="submit" @click.prevent="save()" x-text="(type == null || type == 1) ? 'Save' : 'Build & Test'"></button>
            </fieldset>
        </form>
        <form x-data="currentSupplier" class="border border-slate-200 rounded m-2 p-2"
            @supplierloaded.window="displaySupplierData($event)"> <!-- Existing Automation -->
            <h2 class="text-center font-bold text-lg" x-text="Alpine.store('selectedSupplierLabel') ? Alpine.store('selectedSupplierLabel') + ' Automations' : 'Existing Automations'"></h2>
            <fieldset>
                <template x-for="automation in automations">
                    <div class="border-b border-slate-200 m-1 p-1">
                        <div class="flex align-middle justify-between">
                            <label :for="automation.id">
                                <input type="radio" :value="automation.id" :id="automation.id" name="existing_automations" x-model="selected_automation_id">
                                <span x-text="automation.name + ' (ID: ' + automation.id + ')'"></span>
                            </label>
                            <span class="mt-2 mx-2" x-text="automation.type == 0 ? '&#9658; Automation' : '&#11123; Download'"></span>
                        </div>
                        <div class="flex align-middle justify-center gap-3">
                            <span class="text-xs" x-text="'&#128193; ' + automation.location"></span>
                            <span class="text-xs" x-text="'&#127758; ' + automation.url"></span>
                        </div>
                    </div>
                </template>
                <template x-if="automations.length < 1">
                    <p class="italic text-center text-xs">No automations yet.</p>
                </template>
            </fieldset>
            <fieldset>
                <button class="bg-red-500 text-white py-0" @click.prevent="deleteSelectedAutomation()" type="button">Delete</button>
            </fieldset>
        </form>
    </div>
    <script type="text/javascript" src="../static/js/supplier.js"></script>
    <script type="text/javascript" src="../static/js/flash.js"></script>
</body>
</html>